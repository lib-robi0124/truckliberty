@model LoginViewModel
@{
    ViewData["Title"] = "Login - Transport System";
    Layout = "_Layout";

    var userType = ViewData["UserType"] as string ?? "company";
    var isTransporter = userType == "transporter";
    var isCompany = userType == "company";
}

<div class="container-fluid d-flex align-items-center justify-content-center" style="min-height: calc(100vh - 200px);">
    <div class="row w-100 justify-content-center">
        <div class="col-md-6 col-lg-5 col-xl-4">
            <div class="card shadow-lg border-0" style="border-radius: 15px;">
                <div class="card-header bg-white text-center py-4 border-0">
                    <h3 class="mb-2 fw-bold text-primary">Transport System</h3>
                    <p class="text-muted mb-0">Please select your login type</p>
                </div>

                <div class="card-body p-4 p-md-5">
                    <div class="mb-4">
                        <div class="d-flex gap-2" role="group">
                            <button type="button"
                                    class="btn flex-grow-1 @(isCompany ? "btn-primary" : "btn-outline-primary") py-3 fw-medium"
                                    onclick="setUserType('company')">
                                Company Login
                            </button>
                            <button type="button"
                                    class="btn flex-grow-1 @(isTransporter ? "btn-primary" : "btn-outline-primary") py-3 fw-medium"
                                    onclick="setUserType('transporter')">
                                Transporter Login
                            </button>
                        </div>
                    </div>

                    <form asp-action="Login" method="post" id="loginForm" class="mt-4">
                        <input type="hidden" name="userType" id="userType" value="@userType" />
                        <input type="hidden" name="returnUrl" value="@ViewData["ReturnUrl"]" />

                        <div class="mb-4">
                            <label asp-for="Email" class="form-label fw-medium mb-2">Email Address</label>
                            <input asp-for="Email" class="form-control form-control-lg"
                                   placeholder="Enter your email address"
                                   style="padding: 0.875rem; border-radius: 8px; border: 1px solid #dee2e6;" />
                            <span asp-validation-for="Email" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Password" class="form-label fw-medium mb-2">Password</label>
                            <input asp-for="Password" type="password"
                                   class="form-control form-control-lg"
                                   placeholder="Enter your password"
                                   style="padding: 0.875rem; border-radius: 8px; border: 1px solid #dee2e6;" />
                            <span asp-validation-for="Password" class="text-danger small mt-1 d-block"></span>
                        </div>

                        <div class="d-grid gap-2 mt-5">
                            <button type="submit" class="btn btn-primary btn-lg py-3 fw-bold" id="loginButton"
                                    style="border-radius: 8px; font-size: 1.1rem;">
                                Login as @(isCompany ? "Company" : "Transporter")
                            </button>
                        </div>
                    </form>

                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div class="alert alert-danger alert-dismissible fade show mt-4" role="alert">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <div>@TempData["ErrorMessage"]</div>
                            </div>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    }

                    <div asp-validation-summary="ModelOnly" class="alert alert-danger mt-4"></div>

                    <div class="text-center mt-4 pt-3 border-top">
                        <a href="#" class="text-decoration-none text-primary small fw-medium">
                            <i class="fas fa-key me-1"></i>Forgot Password?
                        </a>
                    </div>
                </div>

                <div class="card-footer bg-light text-center py-3 border-0" style="border-bottom-left-radius: 15px; border-bottom-right-radius: 15px;">
                    <p class="text-muted mb-0 small">
                        <i class="fas fa-info-circle me-1"></i>
                        Select appropriate login type based on your account
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function setUserType(type) {
            document.getElementById('userType').value = type;

            const companyBtn = document.querySelector('button[onclick="setUserType(\'company\')"]');
            const transporterBtn = document.querySelector('button[onclick="setUserType(\'transporter\')"]');
            const loginBtn = document.getElementById('loginButton');

            // Reset both buttons
            companyBtn.classList.remove('btn-primary', 'btn-outline-primary');
            transporterBtn.classList.remove('btn-primary', 'btn-outline-primary');

            // Apply correct classes
            if (type === 'company') {
                companyBtn.classList.add('btn-primary');
                transporterBtn.classList.add('btn-outline-primary');
                loginBtn.textContent = 'Login as Company';
            } else {
                transporterBtn.classList.add('btn-primary');
                companyBtn.classList.add('btn-outline-primary');
                loginBtn.textContent = 'Login as Transporter';
            }

            // Update URL
            const url = new URL(window.location);
            url.searchParams.set('userType', type);
            window.history.replaceState({}, '', url);

            // Clear form
            const form = document.getElementById('loginForm');
            const inputs = form.querySelectorAll('input[type="email"], input[type="password"], input[type="text"]');
            inputs.forEach(input => input.value = '');

            // Clear validation errors
            const errorSpans = form.querySelectorAll('.text-danger');
            errorSpans.forEach(span => span.textContent = '');
        }

        // Set initial state on page load
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const userType = urlParams.get('userType');
            if (userType === 'transporter' || userType === 'company') {
                setUserType(userType);
            }

            // Focus on email field
            const emailInput = document.querySelector('input[asp-for="Email"]');
            if (emailInput) {
                emailInput.focus();
            }
        });
    </script>

    <style>
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .card {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: none;
        }

        .btn-outline-primary {
            border: 2px solid #0d6efd;
        }

            .btn-outline-primary:hover {
                background-color: #0d6efd;
                color: white;
            }

        .form-control-lg:focus {
            border-color: #0d6efd;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        .alert {
            border-radius: 8px;
            border: none;
        }
    </style>
}